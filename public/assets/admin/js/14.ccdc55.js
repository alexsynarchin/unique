"use strict";(self.webpackChunkunique=self.webpackChunkunique||[]).push([[14],{49334:(t,e,o)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}o.d(e,{I:()=>i});var i=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errors={}},(e=[{key:"has",value:function(t){return this.errors.hasOwnProperty(t)}},{key:"any",value:function(){return Object.keys(this.errors).length>0}},{key:"get",value:function(t){if(this.errors[t])return this.errors[t][0]}},{key:"getFlash",value:function(t){if(this.errors[t])return this.errors[t]}},{key:"record",value:function(t){this.errors=t}},{key:"clear",value:function(t){t?this.has(t)&&delete this.errors[t]:this.errors={}}}])&&n(t.prototype,e),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,o}()},54014:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});var r=o(49334);const n={props:{form:{type:Object},action_type:{type:String},action_url:{type:String}},computed:{maxDiscount:function(){return"percent"===this.form.discount_type?100:1/0},disableDiscountInput:function(){return!this.form.discount_type}},data:function(){return{discount_types:[{label:"Проценты",value:"percent"},{label:"Рубли",value:"rubles"}],errors:new r.I}},methods:{closeModal:function(){this.$emit("close-modal")},submitForm:function(t){var e=this;axios({method:this.action_type,url:this.action_url,data:this.form}).then((function(t){e.$emit("submit-form",t.data)})).catch((function(t){e.errors.record(t.response.data.errors)}))}}};var a=o(14486);const i=(0,a.A)(n,(function(){var t=this,e=t._self._c;return e("el-form",{attrs:{model:t.form,"label-position":"top"}},[e("el-form-item",{attrs:{prop:"discount_type",label:"Тип скидки",error:t.errors.get("discount_type")}},[e("el-select",{attrs:{placeholder:"Выбрать тип скидки"},model:{value:t.form.discount_type,callback:function(e){t.$set(t.form,"discount_type",e)},expression:"form.discount_type"}},t._l(t.discount_types,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),e("div",{staticClass:"row"},[e("el-form-item",{staticClass:"col-md-6",attrs:{label:"Время действия",prop:"range",error:t.errors.get("range")}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"/","start-placeholder":"Дата начала","end-placeholder":"Дата завершения",format:"dd-MM-yyyy","value-format":"dd-MM-yyyy"},model:{value:t.form.range,callback:function(e){t.$set(t.form,"range",e)},expression:"form.range"}})],1),t._v(" "),e("el-form-item",{staticClass:"col-md-6",attrs:{prop:"discount",error:t.errors.get("discount")}},[t._t("label",(function(){return[e("label",{staticClass:"el-form-item__label",staticStyle:{display:"block"}},[t._v("\n                    Размер скидки, "),"percent"===t.form.discount_type?e("span",[t._v("%")]):e("span",[t._v("руб.")])])]})),t._v(" "),e("el-input-number",{attrs:{step:5,min:0,max:t.maxDiscount,disabled:t.disableDiscountInput},model:{value:t.form.discount,callback:function(e){t.$set(t.form,"discount",e)},expression:"form.discount"}})],2)],1),t._v(" "),e("el-row",{attrs:{gutter:15}},[e("el-col",{attrs:{span:14}},[e("el-form-item",{attrs:{label:"Промокод (значение)",prop:"name",error:t.errors.get("name")}},[e("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"Количество использований",prop:"max_count",error:t.errors.get("max_count")}},[e("el-input-number",{attrs:{step:10,min:0},model:{value:t.form.max_count,callback:function(e){t.$set(t.form,"max_count",e)},expression:"form.max_count"}})],1)],1)],1),t._v(" "),e("div",{staticClass:"d-flex justify-content-center"},[e("el-button",{staticStyle:{"margin-right":"1rem"},attrs:{icon:"el-icon-plus",type:"success"},on:{click:function(e){return e.preventDefault(),t.submitForm("promoForm")}}},[t._v("Сохранить")]),t._v(" "),e("el-button",{on:{click:t.closeModal}},[t._v("Отмена")])],1)],1)}),[],!1,null,null,null).exports,l={components:{PromoForm:i},data:function(){return{action_type:"post",action_url:"/api/admin/promo-codes",form:{discount_type:"",range:"",name:"",discount:0,max_count:0}}},methods:{closeModal:function(){this.$emit("close-modal")},submitForm:function(t){this.$emit("create-promo-code",t)}}};const s={components:{PromoForm:i},props:["id"],data:function(){return{form:{},action_type:"put",action_url:"/api/admin/promo-codes/"+this.id}},methods:{getData:function(){var t=this;axios.get("/api/admin/promo-codes/"+this.id).then((function(e){t.form=e.data,t.form.range=[e.data.start_time,e.data.end_time]}))},closeModal:function(){},submitForm:function(t){this.$emit("edit-promo-code",t)}},mounted:function(){this.getData()}};const c={components:{Create:(0,a.A)(l,(function(){var t=this;return(0,t._self._c)("promo-form",{attrs:{form:t.form,action_type:t.action_type,action_url:t.action_url},on:{"close-modal":t.closeModal,"submit-form":t.submitForm}})}),[],!1,null,null,null).exports,Edit:(0,a.A)(s,(function(){var t=this;return(0,t._self._c)("promo-form",{attrs:{form:t.form,action_type:t.action_type,action_url:t.action_url},on:{"close-modal":t.closeModal,"submit-form":t.submitForm}})}),[],!1,null,null,null).exports},computed:{ModalTitle:function(){return"create"===this.state?"Новый промокод":"edit"===this.state?"Редактировать промокод":""}},data:function(){return{CanAccess:'Просмотр "Промокоды"',tableData:[],dialogVisible:!1,state:"",currentId:null}},methods:{handleEdit:function(t){this.currentId=t.id,this.dialogVisible=!0,this.state="edit"},handleDelete:function(t){var e=this;this.$confirm("Вы уверены что хотите удалить промокод","Удаление промокода",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then((function(){axios.delete("/api/admin/promo-codes/"+t.id).then((function(t){var o=e.tableData.findIndex((function(e){return e.id===t.data.id}));e.tableData.splice(o,1),e.$message({type:"success",message:"Промокод удален"})}))})).catch((function(){}))},editPromoCode:function(t){var e=this.tableData.findIndex((function(e){return e.id===t.id}));this.tableData[e]=t,this.closeModal()},getTableData:function(){var t=this;axios.get("/api/admin/promo-codes").then((function(e){t.tableData=e.data}))},createPromoCode:function(t){this.tableData.push(t),this.closeModal()},closeModal:function(){this.dialogVisible=!1,this.currentId=null},addPromoCode:function(){this.dialogVisible=!0,this.state="create"},handleClose:function(){this.closeModal()}},mounted:function(){this.getTableData()}};const u=(0,a.A)(c,(function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-4"},[e("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:function(e){return e.preventDefault(),t.addPromoCode.apply(null,arguments)}}},[t._v("Новый промокод")])],1)]),t._v(" "),e("data-tables",{attrs:{data:t.tableData}},[e("el-table-column",{attrs:{type:"index"}}),t._v(" "),e("el-table-column",{attrs:{label:"Промокод",prop:"name",width:"200",sortable:""}}),t._v(" "),e("el-table-column",{attrs:{sortable:"",label:"Действует с",prop:"start_time"}}),t._v(" "),e("el-table-column",{attrs:{sortable:"",label:"Заканчивается",prop:"end_time"}}),t._v(" "),e("el-table-column",{attrs:{sortable:"",label:"Количество",prop:"max_count"}}),t._v(" "),e("el-table-column",{attrs:{sortable:"",label:"Скидка",prop:"discount"}}),t._v(" "),e("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleEdit(o.row)}}},[t._v("\n                    Редактировать\n                ")]),t._v(" "),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.handleDelete(o.row)}}},[t._v("\n                    Удалить\n                ")])]}}])})],1),t._v(" "),e("el-dialog",{attrs:{title:t.ModalTitle,visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.dialogVisible&&"create"===t.state?e("create",{on:{"close-modal":function(t){},"create-promo-code":t.createPromoCode}}):t._e(),t._v(" "),t.dialogVisible&&"edit"===t.state?e("edit",{attrs:{id:t.currentId},on:{"close-modal":function(t){},"edit-promo-code":t.editPromoCode}}):t._e()],1)],1)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=14.ccdc55.js.map