"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[681],{95844:(t,e,o)=>{function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}o.d(e,{D:()=>r});var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errors={}}var e,o,r;return e=t,(o=[{key:"has",value:function(t){return this.errors.hasOwnProperty(t)}},{key:"any",value:function(){return Object.keys(this.errors).length>0}},{key:"get",value:function(t){if(this.errors[t])return this.errors[t][0]}},{key:"getFlash",value:function(t){if(this.errors[t])return this.errors[t]}},{key:"record",value:function(t){this.errors=t}},{key:"clear",value:function(t){t?this.has(t)&&delete this.errors[t]:this.errors={}}}])&&n(e.prototype,o),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},32681:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});var n=o(95844);const r={props:{form:{type:Object},action_type:{type:String},action_url:{type:String}},computed:{maxDiscount:function(){return"percent"===this.form.discount_type?100:1/0},disableDiscountInput:function(){return!this.form.discount_type}},data:function(){return{discount_types:[{label:"Проценты",value:"percent"},{label:"Рубли",value:"rubles"}],errors:new n.D}},methods:{closeModal:function(){this.$emit("close-modal")},submitForm:function(t){var e=this;axios({method:this.action_type,url:this.action_url,data:this.form}).then((function(t){e.$emit("submit-form",t.data)})).catch((function(t){e.errors.record(t.response.data.errors)}))}}};var a=o(51900);const i=(0,a.Z)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-form",{attrs:{model:t.form,"label-position":"top"}},[o("el-form-item",{attrs:{prop:"discount_type",label:"Тип скидки",error:t.errors.get("discount_type")}},[o("el-select",{attrs:{placeholder:"Выбрать тип скидки"},model:{value:t.form.discount_type,callback:function(e){t.$set(t.form,"discount_type",e)},expression:"form.discount_type"}},t._l(t.discount_types,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),o("div",{staticClass:"row"},[o("el-form-item",{staticClass:"col-md-6",attrs:{label:"Время действия",prop:"range",error:t.errors.get("range")}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"/","start-placeholder":"Дата начала","end-placeholder":"Дата завершения",format:"dd-MM-yyyy","value-format":"dd-MM-yyyy"},model:{value:t.form.range,callback:function(e){t.$set(t.form,"range",e)},expression:"form.range"}})],1),t._v(" "),o("el-form-item",{staticClass:"col-md-6",attrs:{prop:"discount",error:t.errors.get("discount")}},[t._t("label",(function(){return[o("label",{staticClass:"el-form-item__label",staticStyle:{display:"block"}},[t._v("\n                    Размер скидки, "),"percent"===t.form.discount_type?o("span",[t._v("%")]):o("span",[t._v("руб.")])])]})),t._v(" "),o("el-input-number",{attrs:{step:5,min:0,max:t.maxDiscount,disabled:t.disableDiscountInput},model:{value:t.form.discount,callback:function(e){t.$set(t.form,"discount",e)},expression:"form.discount"}})],2)],1),t._v(" "),o("el-row",{attrs:{gutter:15}},[o("el-col",{attrs:{span:14}},[o("el-form-item",{attrs:{label:"Промокод (значение)",prop:"name",error:t.errors.get("name")}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"Количество использований",prop:"max_count",error:t.errors.get("max_count")}},[o("el-input-number",{attrs:{step:10,min:0},model:{value:t.form.max_count,callback:function(e){t.$set(t.form,"max_count",e)},expression:"form.max_count"}})],1)],1)],1),t._v(" "),o("div",{staticClass:"d-flex justify-content-center"},[o("el-button",{staticStyle:{"margin-right":"1rem"},attrs:{icon:"el-icon-plus",type:"success"},on:{click:function(e){return e.preventDefault(),t.submitForm("promoForm")}}},[t._v("Сохранить")]),t._v(" "),o("el-button",{on:{click:t.closeModal}},[t._v("Отмена")])],1)],1)}),[],!1,null,null,null).exports,l={components:{PromoForm:i},data:function(){return{action_type:"post",action_url:"/api/admin/promo-codes",form:{discount_type:"",range:"",name:"",discount:0,max_count:0}}},methods:{closeModal:function(){this.$emit("close-modal")},submitForm:function(t){this.$emit("create-promo-code",t)}}};const s={components:{PromoForm:i},props:["id"],data:function(){return{form:{},action_type:"put",action_url:"/api/admin/promo-codes/"+this.id}},methods:{getData:function(){var t=this;axios.get("/api/admin/promo-codes/"+this.id).then((function(e){t.form=e.data,t.form.range=[e.data.start_time,e.data.end_time]}))},closeModal:function(){},submitForm:function(t){this.$emit("edit-promo-code",t)}},mounted:function(){this.getData()}};const c={components:{Create:(0,a.Z)(l,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("promo-form",{attrs:{form:t.form,action_type:t.action_type,action_url:t.action_url},on:{"close-modal":t.closeModal,"submit-form":t.submitForm}})}),[],!1,null,null,null).exports,Edit:(0,a.Z)(s,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("promo-form",{attrs:{form:t.form,action_type:t.action_type,action_url:t.action_url},on:{"close-modal":t.closeModal,"submit-form":t.submitForm}})}),[],!1,null,null,null).exports},computed:{ModalTitle:function(){return"create"===this.state?"Новый промокод":"edit"===this.state?"Редактировать промокод":""}},data:function(){return{CanAccess:'Просмотр "Промокоды"',tableData:[],dialogVisible:!1,state:"",currentId:null}},methods:{handleEdit:function(t){this.currentId=t.id,this.dialogVisible=!0,this.state="edit"},handleDelete:function(t){var e=this;this.$confirm("Вы уверены что хотите удалить промокод","Удаление промокода",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then((function(){axios.delete("/api/admin/promo-codes/"+t.id).then((function(t){var o=e.tableData.findIndex((function(e){return e.id===t.data.id}));e.tableData.splice(o,1),e.$message({type:"success",message:"Промокод удален"})}))})).catch((function(){}))},editPromoCode:function(t){var e=this.tableData.findIndex((function(e){return e.id===t.id}));this.tableData[e]=t,this.closeModal()},getTableData:function(){var t=this;axios.get("/api/admin/promo-codes").then((function(e){t.tableData=e.data}))},createPromoCode:function(t){this.tableData.push(t),this.closeModal()},closeModal:function(){this.dialogVisible=!1,this.currentId=null},addPromoCode:function(){this.dialogVisible=!0,this.state="create"},handleClose:function(){this.closeModal()}},mounted:function(){this.getTableData()}};const u=(0,a.Z)(c,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("section",[o("div",{staticClass:"row"},[o("div",{staticClass:"col-md-4"},[o("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:function(e){return e.preventDefault(),t.addPromoCode.apply(null,arguments)}}},[t._v("Новый промокод")])],1)]),t._v(" "),o("data-tables",{attrs:{data:t.tableData}},[o("el-table-column",{attrs:{type:"index"}}),t._v(" "),o("el-table-column",{attrs:{label:"Промокод",prop:"name",width:"200",sortable:""}}),t._v(" "),o("el-table-column",{attrs:{sortable:"",label:"Действует с",prop:"start_time"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"",label:"Заканчивается",prop:"end_time"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"",label:"Количество",prop:"max_count"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"",label:"Скидка",prop:"discount"}}),t._v(" "),o("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.handleEdit(e.row)}}},[t._v("\n                    Редактировать\n                ")]),t._v(" "),o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(o){return t.handleDelete(e.row)}}},[t._v("\n                    Удалить\n                ")])]}}])})],1),t._v(" "),o("el-dialog",{attrs:{title:t.ModalTitle,visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.dialogVisible&&"create"===t.state?o("create",{on:{"close-modal":function(t){},"create-promo-code":t.createPromoCode}}):t._e(),t._v(" "),t.dialogVisible&&"edit"===t.state?o("edit",{attrs:{id:t.currentId},on:{"close-modal":function(t){},"edit-promo-code":t.editPromoCode}}):t._e()],1)],1)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=681.4d91d3.js.map